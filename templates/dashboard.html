<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <title>Portal de Venta Diaria</title>
  <!-- Enlace al CSS estático -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

  <style>
    /* Variables y tipografía */
    :root {
      --font-primary: 'Montserrat', sans-serif;
    }

    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family: var(--font-primary);
      background: url("{{ url_for('static', filename='images/fondo.png') }}") no-repeat center/cover;
      background-size: 100vw 100vh;
      background-repeat: no-repeat;
      background-attachment: fixed;
      display: flex;
      flex-direction: column;
      /* <-- add this line */
      justify-content: center;
      align-items: center;
      text-align: center;
      gap: 1.5rem;
      min-height: 100vh;
      justify-content: flex-start;
      /* el contenido empieza arriba */
      align-items: center;
      /* si quieres centrar horizontal */
      padding: 1rem;
      /* un poco de aire */
      overflow-y: auto;
    }

    /* 3) Caja “card” para el login */
    .login-box {
      background: rgba(255, 255, 255, 0.85);
      padding: 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 360px;
      width: 100%;
    }

    /* 4) Inputs */
    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.25rem;
      border: 1px solid #ccc;
      border-radius: 0.375rem;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus {
      outline: none;
      border-color: #0A2140;
    }

    /* 5) Botón */
    button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 1rem;
      background-color: #0A2140;
      color: #fff;
      border: none;
      border-radius: 0.375rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #0A2140;
    }

    /* 6) Responsivo */
    @media (max-width: 400px) {
      .login-box {
        padding: 1rem;
      }

      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>

<body>
  <h1>Bienvenido, {{ username }}</h1>
  <nav>
      {% if role == 'admin' %}
      <a href="{{ url_for('admin') }}">Administración</a> |
      {% endif %}
      <a href="{{ url_for('history') }}">Historial</a> |
      <a href="{{ url_for('logout') }}">Cerrar sesión</a>
    </nav>

    <!-- CAMBIO 1: bloque para mostrar mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul>
      {% for category, msg in messages %}
      <li {% if category=='error' %} style="color:red;" {% else %} style="color:green;" {% endif %}>
        {{ msg }}
      </li>
      {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    <p>Registra tus ventas de hoy (varios menús):</p>

    <form action="{{ url_for('submit') }}" method="post" id="orderForm">
      <!-- Fecha única para toda la orden -->
      <label>Fecha:<br>
        <input type="date" name="date" required>
      </label>
      <br><br>

      <!-- WAREHOUSE: Selección de almacén según sesión -->
      <label>Almacén:<br>
        {% set wh_list = warehouses.keys()|list %}
        {% if wh_list|length > 1 %}
          <select name="warehouse" id="warehouse" required>
            <option value="" disabled selected>Selecciona un almacén…</option>
            {% for wh in wh_list %}
              <option value="{{ wh }}">{{ wh }}</option>
            {% endfor %}
          </select>
        {% else %}
          {# Si sólo hay uno, ocultamos el select y enviamos valor fijo #}
          <input type="hidden" name="warehouse" id="warehouse" value="{{ wh_list[0] or '' }}">
          <strong>{{ wh_list[0] or '—' }}</strong>
        {% endif %}
      </label>
      <div id="cardcode-container"></div>
      <br><br>
      
      <table id="lines">
        <tr>
          <th>Tipo de comida</th>
          <th>Cantidad</th>
          <th>Acción</th>
        </tr>
          <tr class="line">
            <td>
              <select name="item_code" required>
                <option value="" disabled selected>Selecciona un menú…</option>
              </select>
            </td>
            <td>
            <input type="number" name="quantity" min="1" required
              oninvalid="this.setCustomValidity('Introduce una cantidad mayor a cero')"
              oninput="this.setCustomValidity('')" />
          </td>
          <td>
            <button type="button" class="remove">–</button>
          </td>
        </tr>
      </table>

      <p>
        <button type="button" id="addLine">Añadir línea +</button>
      </p>
      <button type="submit">Enviar a SAP</button>
    </form>

    <!-- CAMBIO 2: enlazar historial y Cerrar sesión dentro del body -->
    <p>
      <a href="{{ url_for('history') }}">Ver historial de órdenes →</a> |
      <a href="{{ url_for('logout') }}">Cerrar sesión</a>
    </p>


    <script>
      const warehousesData = {{ warehouses | tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  </body>

</html>